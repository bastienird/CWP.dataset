% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/enrich_dataset_if_needed.R
\name{enrich_dataset_if_needed}
\alias{enrich_dataset_if_needed}
\title{Enrich a CWP dataset with missing labels and geometries}
\usage{
enrich_dataset_if_needed(data, connectionDB = NULL, save_prefix = NULL)
}
\arguments{
\item{data}{A \code{data.frame} or \code{sf} object following CWP standards.}

\item{connectionDB}{Optional. A DBI-compatible database connection.}

\item{save_prefix}{Optional. A prefix for saving output files (\code{.qs} and \code{.csv}).}
}
\value{
A \code{list} with two elements:
\describe{
\item{\code{with_geom}}{An \code{sf} object enriched with geometry.}
\item{\code{without_geom}}{A \code{data.frame} enriched without geometry.}
}
}
\description{
This function enriches a dataset (data.frame or sf) by:
\itemize{
\item filling in missing descriptive labels (species, gear type, fleet, units, etc.),
\item attaching or validating geometries,
using SQL queries, local fallback files, or online downloads.
}
}
\details{
Steps performed:
\itemize{
\item Load required codelists (species, measurements, gear, fleet, etc.) via SQL or fallback.
\item Normalize units (e.g. “Tons” → “t”, “Number of fish” → “no”).
\item Left-join to add each \code{*_label} column alongside its code.
\item Reorder columns: base columns with their labels immediately after.
\item Convert to \code{sf} (CRS EPSG:4326).
\item Optionally save to disk if \code{save_prefix} is provided.
}
}
\examples{
\dontrun{
df <- data.frame(
  species = c("COD", "SAL"),
  measurement_unit = c("Tons", "Number of fish"),
  geographic_identifier = c("0001", "0002"),
  fishing_mode = "LL",
  fishing_fleet = "FleetA",
  measurement_type = "KT",
  measurement = "catch",
  measurement_processing_level = "raised",
  gear_type = "01.1"
)
result <- enrich_dataset_if_needed(df)
str(result)
}

}
\seealso{
\code{\link[sf]{st_as_sf}}, \code{\link[DBI]{dbGetQuery}}
}
